#!/bin/bash

# All-in-one script: Configure + Build + Run
# Executes the complete workflow in sequence

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "==========================================================================================="
echo "                     Command Pattern - Home Automation"
echo "==========================================================================================="
echo ""

# Step 1: Configure
echo "-------------------------------------------------------------------------------------------"
echo "STEP 1: Configuring CMake..."
echo "-------------------------------------------------------------------------------------------"
"$SCRIPT_DIR/conf.sh"
if [ $? -ne 0 ]; then
    echo "✗ Configuration failed. Aborting."
    exit 1
fi
echo ""

# Step 2: Build
echo "-------------------------------------------------------------------------------------------"
echo "STEP 2: Building project..."
echo "-------------------------------------------------------------------------------------------"
"$SCRIPT_DIR/build.sh"
if [ $? -ne 0 ]; then
    echo "✗ Build failed. Aborting."
    exit 1
fi
echo ""

# Step 3: Run
echo "-------------------------------------------------------------------------------------------"
echo "STEP 3: Running executable..."
echo "-------------------------------------------------------------------------------------------"
"$SCRIPT_DIR/run.sh"
if [ $? -ne 0 ]; then
    echo "✗ Execution failed."
    exit 1
fi
echo "-------------------------------------------------------------------------------------------"
echo ""

echo "==========================================================================================="
echo "                             All steps completed successfully!"
echo "==========================================================================================="
